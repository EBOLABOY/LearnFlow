(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[189],{2833:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/dashboard",function(){return t(7639)}])},3323:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});var a=t(5893),r=t(7294),i=t(1163),n=t(7828);function l(e){var s;let{children:t,title:l="管理后台"}=e,[d,o]=(0,r.useState)(!1),{user:x,logout:m}=(0,n.aC)(),h=(0,i.useRouter)(),u=[{name:"仪表板",href:"/admin/dashboard",icon:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"},{name:"用户管理",href:"/admin/users",icon:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"},{name:"邀请码管理",href:"/admin/invitations",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}],g=e=>h.pathname===e;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(d?"":"hidden"),children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>o(!1)}),(0,a.jsxs)("div",{className:"relative flex w-full max-w-xs flex-1 flex-col bg-white",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,a.jsx)("button",{type:"button",className:"ml-1 flex h-10 w-10 items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>o(!1),children:(0,a.jsx)("svg",{className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(0,a.jsx)(c,{navigation:u,isActive:g})]})]}),(0,a.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,a.jsx)("div",{className:"flex min-h-0 flex-1 flex-col bg-white border-r border-gray-200",children:(0,a.jsx)(c,{navigation:u,isActive:g})})}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col lg:pl-64",children:[(0,a.jsx)("div",{className:"sticky top-0 z-10 bg-white shadow-sm border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex h-16 items-center gap-x-4 px-4 sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,a.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>o(!0),children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,a.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,a.jsx)("div",{className:"flex flex-1 items-center",children:(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:l})}),(0,a.jsx)("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-primary-600 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:null==x?void 0:null===(s=x.email)||void 0===s?void 0:s.charAt(0).toUpperCase()})})}),(0,a.jsxs)("div",{className:"hidden min-w-0 flex-1 lg:block",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:null==x?void 0:x.email}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"管理员"})]}),(0,a.jsx)("button",{onClick:m,className:"text-sm text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-md px-2 py-1",children:"退出"})]})})})]})]})}),(0,a.jsx)("main",{className:"flex-1 pb-8",children:(0,a.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:t})})]})]})}function c(e){let{navigation:s,isActive:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex h-16 shrink-0 items-center border-b border-gray-200 px-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-bold text-white",children:"深"})}),(0,a.jsx)("span",{className:"ml-2 text-lg font-semibold text-gray-900",children:"学助手"})]})}),(0,a.jsx)("nav",{className:"flex-1 space-y-1 px-2 py-4",children:s.map(e=>(0,a.jsxs)("a",{href:e.href,className:"\n              group flex items-center px-2 py-2 text-sm font-medium rounded-md transition-colors duration-200\n              ".concat(t(e.href)?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n            "),children:[(0,a.jsx)("svg",{className:"mr-3 h-5 w-5 flex-shrink-0 ".concat(t(e.href)?"text-primary-500":"text-gray-400 group-hover:text-gray-500"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:e.icon})}),e.name]},e.name))})]})}},7639:function(e,s,t){"use strict";t.r(s);var a=t(5893),r=t(7294),i=t(7828),n=t(6166),l=t(3323),c=t(651),d=t(6501);s.default=(0,i.QO)(function(){var e,s,t;let[i,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{h()},[]);let h=async()=>{try{m(!0);let e=await n.Sb.getStats();e.data.success?o(e.data.data):d.ZP.error("获取统计数据失败")}catch(e){console.error("获取统计数据失败:",e),d.ZP.error("获取统计数据失败")}finally{m(!1)}};if(x)return(0,a.jsx)(l.Z,{title:"仪表板",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})});let u=(null==i?void 0:i.users)||{},g=(null==i?void 0:i.invitations)||{},p=(null==i?void 0:i.activity)||{},f=[{title:"总用户数",value:(0,c.uf)(u.total||0),change:"本周新增 ".concat(u.newThisWeek||0),changeType:"positive",icon:"\uD83D\uDC65",color:"bg-blue-500"},{title:"活跃用户",value:(0,c.uf)(u.active||0),change:"本周活跃 ".concat(u.activeThisWeek||0),changeType:"positive",icon:"⚡",color:"bg-green-500"},{title:"可用邀请码",value:(0,c.uf)(g.active||0),change:"本周创建 ".concat(g.createdThisWeek||0),changeType:"neutral",icon:"\uD83C\uDFAB",color:"bg-purple-500"},{title:"已使用邀请码",value:(0,c.uf)(g.used||0),change:"本周使用 ".concat(g.usedThisWeek||0),changeType:"positive",icon:"✅",color:"bg-orange-500"}];return(0,a.jsx)(l.Z,{title:"仪表板",children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg shadow-sm",children:(0,a.jsxs)("div",{className:"px-6 py-8 text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"欢迎回到管理后台"}),(0,a.jsxs)("p",{className:"mt-2 text-primary-100",children:["深学助手用户和邀请码管理系统 \xb7 最后更新: ",(0,c.SY)(null==i?void 0:i.generatedAt)]})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:f.map((e,s)=>(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 p-3 rounded-lg ".concat(e.color),children:(0,a.jsx)("span",{className:"text-2xl",children:e.icon})}),(0,a.jsxs)("div",{className:"ml-4 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.title}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value}),(0,a.jsx)("p",{className:"text-sm ".concat("positive"===e.changeType?"text-green-600":"negative"===e.changeType?"text-red-600":"text-gray-500"),children:e.change})]})]})},s))}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"最新注册用户"})}),(0,a.jsx)("div",{className:"p-6",children:(null===(e=p.recentUsers)||void 0===e?void 0:e.length)>0?(0,a.jsx)("div",{className:"space-y-4",children:p.recentUsers.slice(0,5).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:e.email.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.email}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"admin"===e.role?"管理员":"普通用户"})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(0,c.SY)(e.created_at)})})]},s))}):(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"暂无最新用户"})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"邀请码动态"})}),(0,a.jsx)("div",{className:"p-6",children:(null===(s=p.recentInvitations)||void 0===s?void 0:s.length)>0?(0,a.jsx)("div",{className:"space-y-4",children:p.recentInvitations.slice(0,5).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full mr-3 ".concat(e.used_by?"bg-green-400":"bg-blue-400")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 font-mono",children:e.code}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.used_by?"由 ".concat(e.used_by," 使用"):"等待使用"})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(0,c.SY)(e.used_at||e.created_at)})})]},s))}):(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"暂无邀请码活动"})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"最近操作日志"})}),(0,a.jsx)("div",{className:"p-6",children:(null===(t=p.adminLogs)||void 0===t?void 0:t.length)>0?(0,a.jsx)("div",{className:"space-y-3",children:p.adminLogs.slice(0,8).map((e,s)=>{var t,r;return(0,a.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary-400 mr-3"}),(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm text-gray-900",children:[(0,a.jsx)("span",{className:"font-medium",children:e.admin_email}),(0,a.jsx)("span",{className:"ml-1",children:(t=e.action,e.target_type,({login_success:"登录成功",create_invitations:"创建了邀请码",revoke_invitation:"撤销了邀请码",update_user:"更新了用户信息",delete_user:"删除了用户"})[t]||"执行了 ".concat(t," 操作"))})]})})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(0,c.SY)(e.created_at)})})]},s)})}):(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"暂无操作日志"})})]})]})})})},651:function(e,s,t){"use strict";t.d(s,{Cl:function(){return i},Ds:function(){return l},SY:function(){return r},li:function(){return n},p6:function(){return a},uf:function(){return d},vQ:function(){return c}});let a=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss";if(!e)return"-";let t=new Date(e);if(isNaN(t.getTime()))return"-";let a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),c=String(t.getSeconds()).padStart(2,"0");return s.replace("YYYY",a).replace("MM",r).replace("DD",i).replace("HH",n).replace("mm",l).replace("ss",c)},r=e=>{if(!e)return"-";let s=Math.floor((new Date-new Date(e))/1e3),t=Math.floor(s/60),r=Math.floor(t/60),i=Math.floor(r/24);return s<60?"刚刚":t<60?"".concat(t,"分钟前"):r<24?"".concat(r,"小时前"):i<7?"".concat(i,"天前"):a(e,"YYYY-MM-DD")},i=e=>({active:"status-badge status-active",inactive:"status-badge status-inactive",used:"status-badge status-used",expired:"status-badge status-expired",disabled:"status-badge status-inactive"})[e]||"status-badge status-inactive",n=e=>({active:"活跃",inactive:"未激活",used:"已使用",expired:"已过期",disabled:"已禁用",revoked:"已撤销"})[e]||e,l=(e,s)=>{let t;return function(){for(var a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];clearTimeout(t),t=setTimeout(()=>{clearTimeout(t),e(...r)},s)}},c=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){let s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.focus(),s.select();try{return document.execCommand("copy"),!0}catch(e){return!1}finally{document.body.removeChild(s)}}},d=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},function(e){e.O(0,[888,774,179],function(){return e(e.s=2833)}),_N_E=e.O()}]);