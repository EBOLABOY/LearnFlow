(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{6747:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return a(5736)}])},3323:function(e,s,a){"use strict";a.d(s,{Z:function(){return n}});var t=a(5893),r=a(7294),l=a(1163),i=a(7828);function n(e){var s;let{children:a,title:n="管理后台"}=e,[d,o]=(0,r.useState)(!1),{user:x,logout:m}=(0,i.aC)(),h=(0,l.useRouter)(),u=[{name:"仪表板",href:"/admin/dashboard",icon:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"},{name:"用户管理",href:"/admin/users",icon:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"},{name:"邀请码管理",href:"/admin/invitations",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}],g=e=>h.pathname===e;return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(d?"":"hidden"),children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>o(!1)}),(0,t.jsxs)("div",{className:"relative flex w-full max-w-xs flex-1 flex-col bg-white",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,t.jsx)("button",{type:"button",className:"ml-1 flex h-10 w-10 items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>o(!1),children:(0,t.jsx)("svg",{className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(0,t.jsx)(c,{navigation:u,isActive:g})]})]}),(0,t.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,t.jsx)("div",{className:"flex min-h-0 flex-1 flex-col bg-white border-r border-gray-200",children:(0,t.jsx)(c,{navigation:u,isActive:g})})}),(0,t.jsxs)("div",{className:"flex flex-1 flex-col lg:pl-64",children:[(0,t.jsx)("div",{className:"sticky top-0 z-10 bg-white shadow-sm border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex h-16 items-center gap-x-4 px-4 sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,t.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>o(!0),children:(0,t.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,t.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center",children:(0,t.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:n})}),(0,t.jsx)("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-primary-600 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-medium text-white",children:null==x?void 0:null===(s=x.email)||void 0===s?void 0:s.charAt(0).toUpperCase()})})}),(0,t.jsxs)("div",{className:"hidden min-w-0 flex-1 lg:block",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:null==x?void 0:x.email}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"管理员"})]}),(0,t.jsx)("button",{onClick:m,className:"text-sm text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-md px-2 py-1",children:"退出"})]})})})]})]})}),(0,t.jsx)("main",{className:"flex-1 pb-8",children:(0,t.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:a})})]})]})}function c(e){let{navigation:s,isActive:a}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex h-16 shrink-0 items-center border-b border-gray-200 px-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"h-8 w-8 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-bold text-white",children:"深"})}),(0,t.jsx)("span",{className:"ml-2 text-lg font-semibold text-gray-900",children:"学助手"})]})}),(0,t.jsx)("nav",{className:"flex-1 space-y-1 px-2 py-4",children:s.map(e=>(0,t.jsxs)("a",{href:e.href,className:"\n              group flex items-center px-2 py-2 text-sm font-medium rounded-md transition-colors duration-200\n              ".concat(a(e.href)?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n            "),children:[(0,t.jsx)("svg",{className:"mr-3 h-5 w-5 flex-shrink-0 ".concat(a(e.href)?"text-primary-500":"text-gray-400 group-hover:text-gray-500"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:e.icon})}),e.name]},e.name))})]})}},5736:function(e,s,a){"use strict";a.r(s);var t=a(5893),r=a(7294),l=a(7828),i=a(6166),n=a(3323),c=a(651),d=a(6501);s.default=(0,l.QO)(function(){let[e,s]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),[o,x]=(0,r.useState)({}),[m,h]=(0,r.useState)({page:1,limit:20,search:"",role:"",status:""});(0,r.useEffect)(()=>{g()},[m]);let u=(0,c.Ds)(e=>{h(s=>({...s,search:e,page:1}))},500),g=async()=>{try{l(!0);let e=await i.Sb.getUsers(m);e.data.success?(s(e.data.data.users),x(e.data.data.pagination)):d.ZP.error("获取用户列表失败")}catch(e){console.error("获取用户列表失败:",e),d.ZP.error("获取用户列表失败")}finally{l(!1)}},p=async(e,s)=>{let a="active"===s?"disabled":"active",t="active"===a?"启用":"禁用";try{(await i.Sb.updateUser(e,{status:a})).data.success?(d.ZP.success("用户".concat(t,"成功")),g()):d.ZP.error("用户".concat(t,"失败"))}catch(e){var r,l;console.error("用户".concat(t,"失败:"),e),d.ZP.error((null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||"用户".concat(t,"失败"))}},v=async(e,s)=>{try{(await i.Sb.updateUser(e,{role:s})).data.success?(d.ZP.success("用户角色更新成功"),g()):d.ZP.error("用户角色更新失败")}catch(e){var a,t;console.error("用户角色更新失败:",e),d.ZP.error((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"用户角色更新失败")}},f=async(e,s)=>{if(confirm("确定要删除用户 ".concat(s," 吗？此操作将禁用该用户账户。")))try{(await i.Sb.deleteUser(e)).data.success?(d.ZP.success("用户删除成功"),g()):d.ZP.error("用户删除失败")}catch(e){var a,t;console.error("用户删除失败:",e),d.ZP.error((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"用户删除失败")}},j=e=>{h(s=>({...s,page:e}))},b=(e,s)=>{h(a=>({...a,[e]:s,page:1}))};return(0,t.jsx)(n.Z,{title:"用户管理",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"用户管理"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"管理系统用户账户和权限"})]})}),(0,t.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"搜索用户"}),(0,t.jsx)("input",{type:"text",placeholder:"输入邮箱搜索...",className:"form-input",onChange:e=>u(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"用户角色"}),(0,t.jsxs)("select",{className:"form-input",value:m.role,onChange:e=>b("role",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"全部角色"}),(0,t.jsx)("option",{value:"user",children:"普通用户"}),(0,t.jsx)("option",{value:"admin",children:"管理员"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"账户状态"}),(0,t.jsxs)("select",{className:"form-input",value:m.status,onChange:e=>b("status",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"全部状态"}),(0,t.jsx)("option",{value:"active",children:"活跃"}),(0,t.jsx)("option",{value:"disabled",children:"已禁用"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"每页显示"}),(0,t.jsxs)("select",{className:"form-input",value:m.limit,onChange:e=>b("limit",parseInt(e.target.value)),children:[(0,t.jsx)("option",{value:10,children:"10条"}),(0,t.jsx)("option",{value:20,children:"20条"}),(0,t.jsx)("option",{value:50,children:"50条"}),(0,t.jsx)("option",{value:100,children:"100条"})]})]})]})}),(0,t.jsx)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:a?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"table-container",children:(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{className:"table-header",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"table-header-cell",children:"用户信息"}),(0,t.jsx)("th",{className:"table-header-cell",children:"角色"}),(0,t.jsx)("th",{className:"table-header-cell",children:"状态"}),(0,t.jsx)("th",{className:"table-header-cell",children:"注册时间"}),(0,t.jsx)("th",{className:"table-header-cell",children:"最后登录"}),(0,t.jsx)("th",{className:"table-header-cell",children:"邀请码使用"}),(0,t.jsx)("th",{className:"table-header-cell",children:"操作"})]})}),(0,t.jsx)("tbody",{className:"table-body",children:e.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-medium text-gray-600",children:e.email.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.email}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["ID: ",e.id]})]})]})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("select",{value:e.role,onChange:s=>v(e.id,s.target.value),className:"text-xs rounded-md border-gray-300 focus:border-primary-500 focus:ring-primary-500",disabled:"admin"===e.role&&1===o.total,children:[(0,t.jsx)("option",{value:"user",children:"普通用户"}),(0,t.jsx)("option",{value:"admin",children:"管理员"})]})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsx)("span",{className:(0,c.Cl)(e.status),children:(0,c.li)(e.status)})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:(0,c.p6)(e.created_at,"YYYY-MM-DD")}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(0,c.SY)(e.created_at)})]})}),(0,t.jsx)("td",{className:"table-cell",children:e.last_login?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:(0,c.p6)(e.last_login,"YYYY-MM-DD")}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(0,c.SY)(e.last_login)})]}):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"从未登录"})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[e.invitations_used||0," 个"]})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>p(e.id,e.status),className:"text-xs px-2 py-1 rounded-md transition-colors duration-200 ".concat("active"===e.status?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:"active"===e.status?"禁用":"启用"}),(0,t.jsx)("button",{onClick:()=>f(e.id,e.email),className:"text-xs px-2 py-1 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md transition-colors duration-200",disabled:"admin"===e.role&&1===o.total,children:"删除"})]})})]},e.id))})]})}),o.totalPages>1&&(0,t.jsxs)("div",{className:"px-6 py-3 border-t border-gray-200 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,t.jsx)("button",{onClick:()=>j(o.page-1),disabled:!o.hasPrev,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"上一页"}),(0,t.jsx)("button",{onClick:()=>j(o.page+1),disabled:!o.hasNext,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"下一页"})]}),(0,t.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:["显示第 ",(0,t.jsx)("span",{className:"font-medium",children:(o.page-1)*o.limit+1})," 到"," ",(0,t.jsx)("span",{className:"font-medium",children:Math.min(o.page*o.limit,o.total)})," ","条，共 ",(0,t.jsx)("span",{className:"font-medium",children:o.total})," 条记录"]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[(0,t.jsx)("button",{onClick:()=>j(o.page-1),disabled:!o.hasPrev,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),Array.from({length:Math.min(5,o.totalPages)},(e,s)=>{let a=Math.max(1,o.page-2)+s;return a>o.totalPages?null:(0,t.jsx)("button",{onClick:()=>j(a),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium ".concat(a===o.page?"z-10 bg-primary-50 border-primary-500 text-primary-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:a},a)}),(0,t.jsx)("button",{onClick:()=>j(o.page+1),disabled:!o.hasNext,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})})]})]})]})})]})})})},651:function(e,s,a){"use strict";a.d(s,{Cl:function(){return l},Ds:function(){return n},SY:function(){return r},li:function(){return i},p6:function(){return t},uf:function(){return d},vQ:function(){return c}});let t=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss";if(!e)return"-";let a=new Date(e);if(isNaN(a.getTime()))return"-";let t=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),n=String(a.getMinutes()).padStart(2,"0"),c=String(a.getSeconds()).padStart(2,"0");return s.replace("YYYY",t).replace("MM",r).replace("DD",l).replace("HH",i).replace("mm",n).replace("ss",c)},r=e=>{if(!e)return"-";let s=Math.floor((new Date-new Date(e))/1e3),a=Math.floor(s/60),r=Math.floor(a/60),l=Math.floor(r/24);return s<60?"刚刚":a<60?"".concat(a,"分钟前"):r<24?"".concat(r,"小时前"):l<7?"".concat(l,"天前"):t(e,"YYYY-MM-DD")},l=e=>({active:"status-badge status-active",inactive:"status-badge status-inactive",used:"status-badge status-used",expired:"status-badge status-expired",disabled:"status-badge status-inactive"})[e]||"status-badge status-inactive",i=e=>({active:"活跃",inactive:"未激活",used:"已使用",expired:"已过期",disabled:"已禁用",revoked:"已撤销"})[e]||e,n=(e,s)=>{let a;return function(){for(var t=arguments.length,r=Array(t),l=0;l<t;l++)r[l]=arguments[l];clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),e(...r)},s)}},c=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(a){let s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.focus(),s.select();try{return document.execCommand("copy"),!0}catch(e){return!1}finally{document.body.removeChild(s)}}},d=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6747)}),_N_E=e.O()}]);