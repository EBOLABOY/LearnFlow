# 深学助手认证系统测试指南

## 🧪 完整测试流程

### 📋 测试前准备清单

- [ ] SQLPub数据库已创建并执行了 `database/init.sql`
- [ ] Vercel项目已部署成功  
- [ ] 环境变量已在Vercel Dashboard中配置
- [ ] 前端API_BASE_URL已更新为实际的Vercel URL
- [ ] Chrome扩展已重新构建 (`npm run build`)
- [ ] Chrome扩展已加载到浏览器 (开发者模式)

### 🔧 API端点测试

#### 1. 测试注册API

```bash
# 替换为您的实际Vercel URL
curl -X POST https://your-vercel-url.vercel.app/api/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testpass123",
    "inviteCode": "DEEPLEARN-PRO-2025"
  }'
```

**预期响应:**
```json
{
  "success": true,
  "message": "注册成功",
  "userId": 1
}
```

#### 2. 测试登录API

```bash
curl -X POST https://your-vercel-url.vercel.app/api/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testpass123"
  }'
```

**预期响应:**
```json
{
  "success": true,
  "message": "登录成功",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

#### 3. 测试Token验证API

```bash
# 使用上面获取的token
curl -X POST https://your-vercel-url.vercel.app/api/verify \
  -H "Content-Type: application/json" \
  -d '{
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

**预期响应:**
```json
{
  "success": true,
  "message": "Token有效",
  "user": {
    "id": 1,
    "email": "test@example.com"
  }
}
```

### 🎨 Chrome扩展UI测试

#### 测试场景1: 未登录状态

1. **打开扩展弹窗**
   - 点击Chrome工具栏中的深学助手图标
   - 应该看到登录/注册界面

2. **界面元素检查**
   - [ ] 显示"登录"和"注册"两个标签
   - [ ] 默认选中"登录"标签
   - [ ] 登录表单包含邮箱和密码输入框
   - [ ] 注册表单包含邮箱、密码和邀请码输入框
   - [ ] 不显示网站功能相关界面

#### 测试场景2: 注册流程测试

1. **切换到注册标签**
   - [ ] 点击"注册"标签，界面切换正常
   - [ ] 登录表单隐藏，注册表单显示

2. **输入验证测试**
   - [ ] 空字段提交显示"请填写完整的注册信息"
   - [ ] 无效邮箱格式显示"请输入有效的邮箱地址"
   - [ ] 密码少于6位显示"密码至少需要6位字符"
   - [ ] 错误邀请码显示"邀请码无效"

3. **成功注册测试**
   - [ ] 输入有效信息，点击注册按钮
   - [ ] 按钮文本变为"注册中..."且禁用
   - [ ] 注册成功显示"注册成功！请使用您的邮箱登录。"
   - [ ] 自动切换到登录标签

#### 测试场景3: 登录流程测试

1. **输入验证测试**
   - [ ] 空字段提交显示"请填写完整的登录信息"
   - [ ] 无效邮箱格式显示"请输入有效的邮箱地址"
   - [ ] 错误密码显示后端返回的错误信息

2. **成功登录测试**
   - [ ] 输入正确的邮箱和密码
   - [ ] 按钮文本变为"登录中..."且禁用
   - [ ] 登录成功显示"登录成功！"
   - [ ] 1秒后界面切换到已登录状态

#### 测试场景4: 已登录状态

1. **界面切换**
   - [ ] 隐藏登录/注册界面
   - [ ] 显示用户信息卡片，包含用户邮箱
   - [ ] 显示"已认证用户"状态
   - [ ] 显示退出按钮

2. **网站功能显示**
   - [ ] 如果当前在支持的网站（如0755tt.com），显示网站控制界面
   - [ ] 如果在不支持的网站，显示"当前网站不在支持列表中"

#### 测试场景5: 退出登录测试

1. **退出功能**
   - [ ] 点击"退出"按钮
   - [ ] 界面立即切换回登录状态
   - [ ] 用户Token已从Chrome Storage中清除
   - [ ] 重新打开弹窗仍显示登录界面

### 🔒 权限控制测试

#### 测试场景6: 自动化功能权限验证

1. **访问支持的学习网站**
   - 访问 `www.0755tt.com` 或其他支持的学习平台

2. **未登录状态测试**
   - [ ] 打开浏览器开发者工具，查看Console
   - [ ] 应该看到 `[深学助手] 用户未认证，跳过自动化功能` 消息
   - [ ] 自动化功能不启动

3. **已登录状态测试**
   - [ ] 在扩展弹窗中登录用户
   - [ ] 刷新学习网站页面
   - [ ] 控制台显示 `[深学助手] 已认证用户启动站点模块: xxx` 消息
   - [ ] 自动化功能正常启动（如视频自动播放、章节测试等）

### 🌐 跨标签页状态同步测试

#### 测试场景7: 多标签页同步

1. **打开多个标签页**
   - 打开多个包含深学助手扩展弹窗的标签页

2. **登录状态同步**
   - [ ] 在一个标签页中登录
   - [ ] 其他标签页的弹窗也自动更新为已登录状态

3. **退出状态同步**
   - [ ] 在一个标签页中退出登录
   - [ ] 其他标签页的弹窗也自动更新为未登录状态

### 🚨 错误处理测试

#### 测试场景8: 网络错误处理

1. **断网测试**
   - [ ] 断开网络连接
   - [ ] 尝试登录，应显示"网络连接失败，请检查网络设置"

2. **API服务异常测试**
   - [ ] 修改API_BASE_URL为错误地址
   - [ ] 尝试登录，应显示网络相关错误信息

#### 测试场景9: Token过期处理

1. **修改Token过期时间**
   - 在后端API中临时将JWT过期时间改为1秒
   - 登录后等待Token过期

2. **自动清理测试**
   - [ ] 过期Token被自动清除
   - [ ] 用户界面切换回登录状态
   - [ ] 自动化功能停止工作

### 📊 性能测试

#### 测试场景10: 性能指标验证

1. **内存使用测试**
   - [ ] 打开Chrome任务管理器
   - [ ] 扩展内存使用 < 10MB（正常使用状态）

2. **响应时间测试**
   - [ ] 弹窗打开时间 < 200ms
   - [ ] 登录响应时间 < 3秒
   - [ ] UI切换动画流畅

### ✅ 测试完成检查表

#### 基础功能测试
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常  
- [ ] Token验证功能正常
- [ ] 退出登录功能正常

#### UI交互测试
- [ ] 标签切换动画流畅
- [ ] 表单验证提示准确
- [ ] 加载状态显示正常
- [ ] 消息提示自动隐藏

#### 权限控制测试
- [ ] 未登录用户无法使用自动化功能
- [ ] 已登录用户可正常使用所有功能
- [ ] Token过期后自动清理并要求重新登录

#### 错误处理测试
- [ ] 网络异常有友好提示
- [ ] 输入验证准确有效
- [ ] API错误信息正确显示

## 🎯 测试报告模板

```
深学助手认证系统测试报告
================================

测试环境：
- Chrome版本: 
- 扩展版本: 
- Vercel URL: 
- 测试日期: 

功能测试结果：
✅ 用户注册: [通过/失败] 
✅ 用户登录: [通过/失败]
✅ Token验证: [通过/失败] 
✅ 权限控制: [通过/失败]
✅ UI交互: [通过/失败]
✅ 错误处理: [通过/失败]

发现的问题：
1. [描述问题1]
2. [描述问题2]

建议改进：
1. [改进建议1] 
2. [改进建议2]

总体评估：[优秀/良好/需改进]
```

## 🔧 故障排除

### 常见问题和解决方案

1. **"Network Error"**
   - 检查Vercel项目是否正常部署
   - 验证API_BASE_URL配置是否正确
   - 确认网络连接正常

2. **"邀请码无效"**
   - 确认Vercel环境变量INVITE_CODE配置正确
   - 检查输入的邀请码是否与.env中一致

3. **"Token验证失败"**
   - 确认JWT_SECRET环境变量配置正确
   - 检查数据库连接是否正常
   - 验证用户记录是否存在

4. **扩展功能无法启动**
   - 确认用户已登录
   - 检查当前网站是否在支持列表中
   - 查看浏览器控制台错误信息

完成以上所有测试后，您的深学助手认证系统就部署成功并可以正常使用了！🎉